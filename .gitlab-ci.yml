
stages:
  - test
  - build
  - performance
  - dast
  - deploy
  
variables:
    TO_PACKAGE: 'appinfo l10n lib templates js img css'
include:
  - project: "e/infra/ecloud/nextcloud-apps/ci-templates"
    ref: main
    file: "nc-apps-lint-build-frontend.yml"
  - project: "e/infra/ecloud/nextcloud-apps/ci-templates"
    ref: main
    file: "nc-apps-deploy.yml"
  - project: "e/infra/ecloud/nextcloud-apps/ci-templates"
    ref: main
    file: "mr-review-tools.yml"
  - project: "e/infra/ecloud/nextcloud-apps/ci-templates"
    ref: main
    file: "git-operations.yml"
  - project: "e/infra/ecloud/nextcloud-apps/ci-templates"
    ref: main
    file: "populate-code-climate-default-config.yml"

deploy:staging:
  extends: .deploy:nextcloud-app
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      when: manual
    - if: $CI_COMMIT_BRANCH == "murena-main"
      when: manual
    - if: $CI_COMMIT_BRANCH == "production"
      when: manual
    - if: $CI_COMMIT_TAG
      when: manual
    - if: $CI_COMMIT_BRANCH == "dev/fix-slowness"
      when: manual   
  environment:
    name: staging/01
    url: $ENV_URL
